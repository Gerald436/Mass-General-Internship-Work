// #States:
// #0: Blinking LED
// #1: On LED
// #2: Off LED
// try doing updateclass(); or smth like that up here
int STATE;
int LED_LIGHT = 9;
int SAFETY_SWITCH = 7;
int REPEAT;

void updateState(){
	///write code for updating the state here
	//1.get a string from python
  //2.Compare it to the set options
  //3.Change the state
  if (Serial.available() > 0){
    String msg = Serial.readString();
    int spaceIndex = msg.indexOf(' ');
    String command = msg.substring(0, spaceIndex); 
    REPEAT = msg.substring(spaceIndex + 1).toInt();

    if (command == "BLINK"){
      //led.blinkLED();
      STATE = 0;
    }
    else if (command == "OFF"){
     //led.turnOFF();
     STATE = 1;
    }
    else if (command == "ON"){
     //led.turnON();
     STATE = 2;
    }
  }
}

class LED {
  public:
    void blinkLED() {
      // while (STATE == 0) { 
        digitalWrite(LED_LIGHT, HIGH);
        delay(100);
        digitalWrite(LED_LIGHT, LOW);
        delay(100);
      // updateState();
      // }
    }
    
    void turnOFF() { 
      digitalWrite(LED_LIGHT, LOW);
    }
    void turnON() {
      digitalWrite(LED_LIGHT, HIGH);
    }
};

LED led;



void executeStateBehavior(){
	////write code for executing the state behavior
  if (digitalRead(SAFETY_SWITCH) == HIGH){
    if (STATE == 0){
      led.blinkLED();
    }
    if (STATE == 1){
     led.turnOFF();
    }
   if (STATE == 2){
     led.turnON();
    }
  }
  else{
     led.turnOFF();
  }
}


void setup() {
  Serial.begin(115200);
  pinMode(LED_LIGHT, OUTPUT);
  pinMode(SAFETY_SWITCH, INPUT);
  
  //Initilize the arduino in state 0:
  digitalWrite(11, HIGH);
  STATE = 1;
  
}

void loop() {

	//1) check if I need update my state
  // if theres some appropriate message (msg) -> transition to that state (e.g. state=1...)
  updateState();
  
  //2) exectute corrresponding behavior to that state
  //if the state is 0, we blink, if the state is 1, we off, ...
  for (int i = 0; i < REPEAT; i++) {
    executeStateBehavior();
  }

  if (STATE != 2){
    STATE =1;
  }
}

  



